<!DOCTYPE html>
<html lang="en" data-bs-theme="light">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        <link rel="canonical" href="https://www.gitee.com/yumoz/%E8%BD%AF%E4%BB%B6%E5%BC%80%E5%8F%91%E7%AC%94%E8%AE%B0/L03-%E4%BF%A1%E5%8F%B7%E4%B8%8E%E7%BA%BF%E7%A8%8B/">
        <link rel="shortcut icon" href="../../img/favicon.ico">
        <title>å›¾ - yumozåšå®¢ç³»ç»Ÿ</title>
        <link href="../../css/bootstrap.min.css" rel="stylesheet">
        <link href="../../css/fontawesome.min.css" rel="stylesheet">
        <link href="../../css/brands.min.css" rel="stylesheet">
        <link href="../../css/solid.min.css" rel="stylesheet">
        <link href="../../css/v4-font-face.min.css" rel="stylesheet">
        <link href="../../css/base.css" rel="stylesheet">
        <link id="hljs-light" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" >
        <link id="hljs-dark" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github-dark.min.css" disabled>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script>hljs.highlightAll();</script> 
    </head>

    <body>
        <div class="navbar fixed-top navbar-expand-lg navbar-dark bg-primary">
            <div class="container">
                <a class="navbar-brand" href="../..">yumozåšå®¢ç³»ç»Ÿ</a>
                <!-- Expander button -->
                <button type="button" class="navbar-toggler" data-bs-toggle="collapse" data-bs-target="#navbar-collapse" aria-controls="navbar-collapse" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <!-- Expanded navigation -->
                <div id="navbar-collapse" class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li class="nav-item">
                                <a href="../.." class="nav-link">é¦–é¡µ</a>
                            </li>
                            <li class="nav-item">
                                <a href="../../01_%E5%A6%82%E4%BD%95%E9%83%A8%E7%BD%B2%E5%8D%9A%E5%AE%A2/" class="nav-link">æ•™ç¨‹</a>
                            </li>
                            <li class="nav-item">
                                <a href="../../about/" class="nav-link">å…³äº</a>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav ms-md-auto">
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-bs-toggle="modal" data-bs-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
            <div class="row">
                    <div class="col-md-3"><div class="navbar-expand-md bs-sidebar hidden-print affix" role="complementary">
    <div class="navbar-header">
        <button type="button" class="navbar-toggler collapsed" data-bs-toggle="collapse" data-bs-target="#toc-collapse" title="Table of Contents">
            <span class="fa fa-angle-down"></span>
        </button>
    </div>

    
    <div id="toc-collapse" class="navbar-collapse collapse card bg-body-tertiary">
        <ul class="nav flex-column">
            
            <li class="nav-item" data-bs-level="1"><a href="#_1" class="nav-link">å›¾</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-bs-level="1"><a href="#27-11-10" class="nav-link">27-11-10</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-bs-level="1"><a href="#_2" class="nav-link">çº¿ç¨‹</a>
              <ul class="nav flex-column">
              </ul>
            </li>
        </ul>
    </div>
</div></div>
                    <div class="col-md-9" role="main">

<h1 id="_1">å›¾</h1>
<div class="toc">
<ul>
<li><a href="#_1">å›¾</a></li>
<li><a href="#27-11-10">27-11-10</a></li>
<li><a href="#_2">çº¿ç¨‹</a></li>
</ul>
</div>
<h1 id="27-11-10">27-11-10</h1>
<p>ç»„é•¿ï¼š</p>
<p>è¿›ç¨‹ç»„ç»„é•¿ï¼šå‘½ä»¤è¡Œä¸Šå¯åŠ¨çš„å¤šä¸ªè¿›ç¨‹ï¼ŒååŒå®ŒæˆæŸç§ä»»åŠ¡ï¼Œå…¶ä¸­ç¬¬ä¸€ä¸ªè¢«åˆ›å»ºå‡ºæ¥çš„è¿›ç¨‹ï¼Œç§°ä¹‹ä¸ºç»„é•¿è¿›ç¨‹ã€‚</p>
<p>å®ˆæŠ¤è¿›ç¨‹æœ¬è´¨ä¹Ÿæ˜¯å­¤å„¿è¿›ç¨‹ã€‚</p>
<p>ä¼šè¯é¦–è¿›ç¨‹æœ‰æƒé™æ‰“å¼€ç»ˆç«¯ã€‚</p>
<p>ps axj | head -1 &amp;&amp; ps axj | grep æ–‡ä»¶å </p>
<p>killall è¿›ç¨‹åç§°  æ€æ‰è¿›ç¨‹ </p>
<p>ls /dev/null  -alå­—ç¬¦æ–‡ä»¶ã€è®¾å¤‡ï¼›æ‰€æœ‰è®¾å¤‡å¾€è¿™ä¸ªæ–‡ä»¶å†™ï¼Œç­‰äºä¸¢å¼ƒè¿™ä¸ªæ–‡ä»¶ï¼Œé€šå¸¸ç”¨æ¥è¿›è¡Œå±è”½ï¼Œdropè¾“å…¥è¾“å‡ºä¿¡æ¯ã€‚</p>
<pre><code class="language-c">//void deamon(int nochidr , int noclose)
int main()
{
    umask(0);// sys/type.h sys/stat.h
    if(fork()&gt;0){
        exit(0);
    }
    signal(SIGCHLD, SIG_IGN);
    setsid();//å°†éç»„é•¿è¿›ç¨‹è®¾ä¸ºæ–°çš„ç‹¬ç«‹ä¼šè¯
    //ifè¯­å¥ï¼Œå¯ä»¥é€‰æ‹©ä¸åšï¼Œé˜²å¾¡æ€§ç¼–ç¨‹
    if(fork()&gt;0){
        //father
        exit(0);
    }

    //å¯é€‰æ‹©é€‰é¡¹
    chdir(&quot;/&quot;);//ä¿®æ”¹å½“å‰è·¯å¾„ä¸ºæ ¹ç›®å½•ï¼Œæ— æ³•æ‰“å¼€ç»ˆç«¯è®¾å¤‡

    if(nochld == 0)
    {
        //å¯é€‰æ‹©é€‰é¡¹
        chdir(&quot;/&quot;);//ä¿®æ”¹å½“å‰è·¯å¾„ä¸ºæ ¹ç›®å½•ï¼Œæ— æ³•æ‰“å¼€ç»ˆç«¯è®¾å¤‡
    }

    //å¯é€‰æ‹©é€‰é¡¹
    close(0);
    int fd = open(&quot;dev/null&quot;, O_RDWR);
    if(fd &lt; 0){return;}
    dup2(fd, 1);
    dup2(fd, 2);

    if(noclose == 0)
    {
        close(0);
        int fd = open(&quot;dev/null&quot;, O_RDWR);
        if(fd &lt; 0){return;}
        dup2(fd, 1);
        dup2(fd, 2);
    }

    //èµ°åˆ°æ­¤å¤„ï¼Œå­™å­è¿›ç¨‹æ‰§è¡Œ
    while(1){
    }
    return 0;
}
int main()
{
    my_daemon(1,1);
    while(1){
        sleep(1);
    }
}
</code></pre>
<p>ls /proc/è¿›ç¨‹ç¼–å·/fd </p>
<p>PGRPæ ‡è®°è¿›ç¨‹ç»„ç»„é•¿ç¼–å·</p>
<p>çˆ¶è¿›ç¨‹å°±æ˜¯ç»„é•¿ï¼Œ</p>
<h1 id="_2">çº¿ç¨‹</h1>
<p>æ—¶é—´ç‚¹ï¼š2021-11-10-00:51:56</p>
<p>task_struct å…±åŒæŒ‡å‘åŒä¸€ä¸ªåœ°å€ç©ºé—´ã€‚</p>
<p>çº¿ç¨‹åœ¨è¿›ç¨‹å†…éƒ¨è¿è¡Œï¼Œçº¿ç¨‹åœ¨è¿›ç¨‹åœ°å€ç©ºé—´å†…è¿è¡Œã€‚</p>
<p>in Linuxï¼Œç«™åœ¨CPUçš„è§’åº¦ï¼Œèƒ½å¦è¯†åˆ«task_structæ˜¯è¿›ç¨‹è¿˜æ˜¯çº¿ç¨‹ï¼Ÿï¼Ÿ</p>
<p>ä»€ä¹ˆæ˜¯è¿›ç¨‹ï¼Ÿï¼ˆç«™åœ¨å†…æ ¸è§’åº¦ï¼‰</p>
<blockquote>
<p>æ‰¿æ‹…åˆ†é…ç³»ç»Ÿèµ„æºçš„åŸºæœ¬å•ä½ ç§°ä¹‹ä¸ºè¿›ç¨‹ã€‚ è¿›ç¨‹åˆ†é…task_struct å’Œåœ°å€ç©ºé—´ï¼›</p>
</blockquote>
<p><strong>ä¹‹å‰å¯¹è¿›ç¨‹çš„ç†è§£</strong>ï¼Œæ‰€æœ‰è¿›ç¨‹éƒ½æ˜¯åªæœ‰ä¸€ä¸ªtask_struct ï¼Œè¯¥è¿›ç¨‹å†…éƒ¨åªæœ‰ä¸€ä¸ªæ‰§è¡Œæµã€‚ã€å•æ‰§è¡Œæµè¿›ç¨‹ã€‘</p>
<p>ç«™åœ¨CPUçš„è§’åº¦ï¼Œin Linuxï¼Œç«™åœ¨CPUçš„è§’åº¦ï¼Œèƒ½å¦è¯†åˆ«task_structæ˜¯è¿›ç¨‹è¿˜æ˜¯çº¿ç¨‹ï¼Ÿï¼Ÿã€ä¸èƒ½ï¼Œä¹Ÿä¸éœ€è¦è¯†åˆ«ï¼Œå› ä¸ºï¼ŒCPUåªå…³å¿ƒä¸€ä¸ªä¸€ä¸ªçš„ç‹¬ç«‹æ‰§è¡Œæµã€‚åœ¨CPUçœ‹æ¥ï¼Œtask_struct &lt;= OSåŸç†ä¸Šé¢çš„è¿›ç¨‹æ§åˆ¶å—çš„ã€‘</p>
<p>åœ¨linuxä¸‹ï¼Œå¹¶ä¸å­˜åœ¨çœŸæ­£çš„å¤šçº¿ç¨‹ï¼Œå…¶å®æ˜¯ç”¨è¿›ç¨‹æ¨¡æ‹Ÿçš„çº¿ç¨‹ã€‚æ€ä¹ˆç†è§£ï¼Ÿå½“çº¿ç¨‹è¶³å¤Ÿå¤šæ—¶ï¼Œæ“ä½œç³»ç»Ÿéœ€è¦ç®¡ç†çº¿ç¨‹ã€‚</p>
<p><strong>Linuxä¸­ï¼Œæ‰€æœ‰æ‰§è¡Œæµï¼Œéƒ½å«åšè½»é‡çº§è¿›ç¨‹</strong>ã€‚</p>
<p>æ—¢ç„¶Linuxå¹¶æ²¡æœ‰çœŸæ­£æ„ä¹‰çš„çº¿ç¨‹ï¼Œæ‰€ä»¥ï¼ŒLinuxä¹Ÿæ²¡æœ‰ç»å¯¹çœŸæ­£æ„ä¹‰ä¸Šçš„çº¿ç¨‹ç›¸å…³çš„åŒè°ƒç”¨ã€‚Linuxæä¾›åˆ›å»ºè½»é‡çº§è¿›ç¨‹çš„æ¥å£ï¼Œåˆ›å»ºè¿›ç¨‹ï¼Œå…±äº«ç©ºé—´ã€‚</p>
<p>é‚£ä¹ˆåœ¨ç”¨æˆ·è§’åº¦ï¼ŒåŸç”Ÿçº¿ç¨‹åº“çš„æ–¹æ¡ˆè§£å†³ï¼ŒåŸºäºè½»é‡çº§è¿›ç¨‹çš„ç³»ç»Ÿè°ƒç”¨ï¼Œç”¨æˆ·å±‚æ¨¡æ‹Ÿå®ç°ä¸€å¥—çº¿ç¨‹æ¥å£ï¼Œpthreadã€‚</p>
<p>32ä½ï¼Œ4*8=32ï¼Œé¡µç›®å½•10ä¸ªæ¯”ç‰¹ä½ã€é¡µè¡¨é¡¹10ä¸ªæ¯”ç‰¹ä½ï¼Œç‰©ç†å†…å­˜12ä¸ªæ¯”ç‰¹ä½å…³ç³»ã€‚ç‰©ç†å†…å­˜ä¸­ä¸€ä¸ª4KBï¼Œè¿™ä¸ª4KBå¯¹åº”çš„æ˜¯å¶æ¡†ï¼Œæ¯ä¸ªé¡µæ¡†å¯¹åº”$2^{12}$ä¸ªåœ°å€ã€‚è¿™äº›æ˜ å°„å…³ç³»ç”±MMUå®Œæˆï¼ŒMMUé›†æˆåœ¨CPUä¸­ã€‚</p>
<pre><code>NAME
       pthread_create - create a new thread

SYNOPSIS
       #include &lt;pthread.h&gt;

       int pthread_create(pthread_t *thread, const pthread_attr_t *attr,
                          void *(*start_routine) (void *), void *arg);

       Compile and link with -pthread.

DESCRIPTION
       The  pthread_create()  function starts a new thread in the calling process.  The new
       thread starts execution by invoking start_routine(); arg is passed as the sole arguâ€
       ment of start_routine().

       pthread_create() å‡½æ•°åœ¨è°ƒç”¨è¿›ç¨‹ä¸­å¯åŠ¨ä¸€ä¸ªæ–°çº¿ç¨‹ã€‚ æ–°çº¿ç¨‹é€šè¿‡è°ƒç”¨ start_routine() å¼€å§‹æ‰§è¡Œï¼› arg ä½œä¸º        start_routine() çš„å”¯ä¸€å‚æ•°ä¼ é€’ã€‚ 

       The new thread terminates in one of the following ways:

       * It  calls  pthread_exit(3),  specifying  an exit status value that is available to
         another thread in the same process that calls pthread_join(3).

       * It returns from start_routine().  This is equivalent  to  calling  pthread_exit(3)
         with the value supplied in the return statement.

       * It is canceled (see pthread_cancel(3)).

       * Any  of  the  threads  in the process calls exit(3), or the main thread performs a
         return from main().  This causes the termination of all threads in the process.

</code></pre>
<p>ä»ç³»ç»Ÿç†è§£char *str = "hello yumoz"; str[1] = "o";å‡ºé”™åŸå› ã€‚å› ä¸ºç‰©ç†å†…å­˜åˆ°æ ˆçš„æ˜ å°„å…³ç³»å‡ºç°é—®é¢˜ã€‚</p>
<p>è®¡ç®—å¯†é›†å‹ï¼šæ‰§è¡Œæµçš„å¤§éƒ¨åˆ†ä»»åŠ¡ï¼Œä¸»è¦ä»¥è®¡ç®—ä¸ºä¸»ï¼šåŠ å¯†è§£å¯†ã€æ’åº</p>
<p>IOå¯†é›†å‹ï¼šæ‰§è¡Œæµçš„å¤§éƒ¨åˆ†ä»»åŠ¡ï¼Œæ˜¯ä»¥IOä¸ºä¸»ï¼Œåˆ·ç£ç›˜ï¼Œè®¿é—®æ•°æ®åº“ï¼Œè®¿é—®ç½‘ç»œã€‚</p>
<p>ğŸ˜Šä¸€ç»„å¯„å­˜å™¨ï¼Œæ ˆï¼Œå°±æ˜¯çº¿ç¨‹å’Œè¿›ç¨‹çš„åŒºåˆ«ã€‚</p>
<hr /></div>
            </div>
        </div>

        <footer class="col-md-12">
            <hr>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script src="../../js/bootstrap.bundle.min.js"></script>
        <script>
            var base_url = "../..",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="../../js/base.js"></script>
        <script src="../../search/main.js"></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="searchModalLabel">Search</h4>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p>From here you can search these documents. Enter your search terms below.</p>
                <form>
                    <div class="form-group">
                        <input type="search" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results" data-no-results-text="No results found"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
